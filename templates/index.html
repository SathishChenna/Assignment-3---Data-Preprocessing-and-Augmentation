<!DOCTYPE html>
<html>
<head>
    <title>File Processor</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="container">
        <h1>File Processor</h1>
        
        <div class="file-type-selector">
            <button onclick="switchFileType('text')" class="type-button active" id="textButton">Text Processing</button>
            <button onclick="switchFileType('image')" class="type-button" id="imageButton">Image Processing</button>
        </div>

        <div class="upload-section">
            <div class="file-input-wrapper">
                <label for="fileInput" class="file-input-label">
                    Choose a file or drag it here
                </label>
                <input type="file" id="fileInput" accept=".txt,.png,.jpg,.jpeg">
                <div class="selected-file" id="selectedFileName">No file selected</div>
            </div>
            <button onclick="processFile()" id="processButton" disabled>Process File</button>
        </div>

        <!-- Text Processing Options -->
        <div id="textOptions" class="options-section">
            <div class="preprocess-options">
                <h2>Text Preprocessing Options</h2>
                {% for option in preprocess_options %}
                <div class="checkbox-item">
                    <input type="checkbox" id="pre_{{ option }}" name="text_preprocess" value="{{ option }}">
                    <label for="pre_{{ option }}">{{ option.replace('_', ' ').title() }}</label>
                </div>
                {% endfor %}
            </div>

            <div class="augmentation-options">
                <h2>Text Augmentation Options</h2>
                {% for option in augmentation_options %}
                <div class="checkbox-item">
                    <input type="checkbox" id="aug_{{ option }}" name="text_augmentation" value="{{ option }}">
                    <label for="aug_{{ option }}">{{ option.replace('_', ' ').title() }}</label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Image Processing Options -->
        <div id="imageOptions" class="options-section" style="display: none;">
            <div class="preprocess-options">
                <h2>Image Preprocessing Options</h2>
                {% for option in image_preprocess_options %}
                <div class="checkbox-item">
                    <input type="checkbox" id="img_pre_{{ option }}" name="image_preprocess" value="{{ option }}">
                    <label for="img_pre_{{ option }}">{{ option.replace('_', ' ').title() }}</label>
                </div>
                {% endfor %}
            </div>

            <div class="augmentation-options">
                <h2>Image Augmentation Options</h2>
                {% for option in image_augmentation_options %}
                <div class="checkbox-item">
                    <input type="checkbox" id="img_aug_{{ option }}" name="image_augmentation" value="{{ option }}">
                    <label for="img_aug_{{ option }}">{{ option.replace('_', ' ').title() }}</label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <!-- Text Results -->
            <div id="textResults">
                <div class="original-text">
                    <h2>Original Text</h2>
                    <pre id="originalText"></pre>
                </div>

                <div class="processed-text">
                    <h2>Processed Text</h2>
                    <div id="preprocessedResults"></div>
                </div>

                <div class="augmented-text">
                    <h2>Augmented Text</h2>
                    <div id="augmentedResults"></div>
                </div>
            </div>

            <!-- Image Results -->
            <div id="imageResults" style="display: none;">
                <div class="original-image">
                    <h2>Original Image</h2>
                    <img id="originalImage" alt="Original image">
                </div>

                <div class="processed-image">
                    <h2>Processed Images</h2>
                    <div id="preprocessedImages"></div>
                </div>

                <div class="augmented-image">
                    <h2>Augmented Images</h2>
                    <div id="augmentedImages"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFileType = 'text';

        function switchFileType(type) {
            currentFileType = type;
            document.getElementById('textButton').classList.toggle('active', type === 'text');
            document.getElementById('imageButton').classList.toggle('active', type === 'image');
            document.getElementById('textOptions').style.display = type === 'text' ? 'grid' : 'none';
            document.getElementById('imageOptions').style.display = type === 'image' ? 'grid' : 'none';
            document.getElementById('textResults').style.display = type === 'text' ? 'block' : 'none';
            document.getElementById('imageResults').style.display = type === 'image' ? 'block' : 'none';
            
            // Update file input accept attribute
            document.getElementById('fileInput').accept = type === 'text' ? '.txt' : '.png,.jpg,.jpeg';
            
            // Clear previous results
            clearResults();
        }

        function clearResults() {
            document.getElementById('originalText').textContent = '';
            document.getElementById('preprocessedResults').innerHTML = '';
            document.getElementById('augmentedResults').innerHTML = '';
            document.getElementById('originalImage').src = '';
            document.getElementById('preprocessedImages').innerHTML = '';
            document.getElementById('augmentedImages').innerHTML = '';
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || 'No file selected';
            document.getElementById('selectedFileName').textContent = fileName;
            document.getElementById('processButton').disabled = !e.target.files[0];
        });

        function formatOperationName(op) {
            return op.replace(/_/g, ' ').split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
            ).join(' ');
        }

        function setLoading(isLoading) {
            const button = document.getElementById('processButton');
            button.disabled = isLoading;
            button.textContent = isLoading ? 'Processing...' : 'Process File';
        }

        async function processFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file first!');
                return;
            }

            setLoading(true);
            clearResults();

            const formData = new FormData();
            formData.append('file', file);

            if (currentFileType === 'text') {
                // Handle text processing
                const preprocessOps = Array.from(document.querySelectorAll('input[name="text_preprocess"]:checked'))
                    .map(cb => cb.value);
                const augmentOps = Array.from(document.querySelectorAll('input[name="text_augmentation"]:checked'))
                    .map(cb => cb.value);
                
                preprocessOps.forEach(op => formData.append('preprocess_ops', op));
                augmentOps.forEach(op => formData.append('augment_ops', op));

                await processTextFile(formData);
            } else {
                // Handle image processing
                const preprocessOps = Array.from(document.querySelectorAll('input[name="image_preprocess"]:checked'))
                    .map(cb => cb.value);
                const augmentOps = Array.from(document.querySelectorAll('input[name="image_augmentation"]:checked'))
                    .map(cb => cb.value);
                
                preprocessOps.forEach(op => formData.append('preprocess_ops', op));
                augmentOps.forEach(op => formData.append('augment_ops', op));

                await processImageFile(formData);
            }

            setLoading(false);
        }

        async function processTextFile(formData) {
            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Server error');
                }
                
                const data = await response.json();
                
                document.getElementById('originalText').textContent = data.original_text || 'No original text';
                
                const preprocessedResults = document.getElementById('preprocessedResults');
                preprocessedResults.innerHTML = '';
                if (Object.keys(data.preprocessed_results || {}).length === 0) {
                    preprocessedResults.innerHTML = '<div class="result-item">No preprocessing operations selected</div>';
                } else {
                    Object.entries(data.preprocessed_results).forEach(([op, text]) => {
                        preprocessedResults.innerHTML += `
                            <div class="result-item">
                                <h3>${formatOperationName(op)}</h3>
                                <pre>${text}</pre>
                            </div>
                        `;
                    });
                }

                const augmentedResults = document.getElementById('augmentedResults');
                augmentedResults.innerHTML = '';
                if (Object.keys(data.augmented_results || {}).length === 0) {
                    augmentedResults.innerHTML = '<div class="result-item">No augmentation operations selected</div>';
                } else {
                    Object.entries(data.augmented_results).forEach(([op, text]) => {
                        augmentedResults.innerHTML += `
                            <div class="result-item">
                                <h3>${formatOperationName(op)}</h3>
                                <pre>${text}</pre>
                            </div>
                        `;
                    });
                }
            } catch (error) {
                console.error('Error:', error);
                alert(`Error processing text: ${error.message}`);
            }
        }

        async function processImageFile(formData) {
            try {
                const response = await fetch('/process_image', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Server error');
                }
                
                const data = await response.json();
                
                // Display original image
                document.getElementById('originalImage').src = `data:image/png;base64,${data.original_image}`;
                
                // Display preprocessed images
                const preprocessedImages = document.getElementById('preprocessedImages');
                preprocessedImages.innerHTML = '';
                if (Object.keys(data.preprocessed_results || {}).length === 0) {
                    preprocessedImages.innerHTML = '<div class="result-item">No preprocessing operations selected</div>';
                } else {
                    Object.entries(data.preprocessed_results).forEach(([op, imageData]) => {
                        preprocessedImages.innerHTML += `
                            <div class="result-item">
                                <h3>${formatOperationName(op)}</h3>
                                <img src="data:image/png;base64,${imageData}" alt="${op} result">
                            </div>
                        `;
                    });
                }

                // Display augmented images
                const augmentedImages = document.getElementById('augmentedImages');
                augmentedImages.innerHTML = '';
                if (Object.keys(data.augmented_results || {}).length === 0) {
                    augmentedImages.innerHTML = '<div class="result-item">No augmentation operations selected</div>';
                } else {
                    Object.entries(data.augmented_results).forEach(([op, imageData]) => {
                        augmentedImages.innerHTML += `
                            <div class="result-item">
                                <h3>${formatOperationName(op)}</h3>
                                <img src="data:image/png;base64,${imageData}" alt="${op} result">
                            </div>
                        `;
                    });
                }
            } catch (error) {
                console.error('Error:', error);
                alert(`Error processing image: ${error.message}`);
            }
        }
    </script>
</body>
</html> 