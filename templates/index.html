<!DOCTYPE html>
<html>
<head>
    <title>Data Processing Studio</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">Data Processing Studio</div>
        </div>
    </nav>

    <div class="container">
        <div class="file-input-section">
            <div class="file-type-cards">
                <div class="file-card">
                    <div class="file-icon text-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <label for="textFileInput" class="file-input-label text-type" id="textInputLabel">
                        Text File
                        <span class="file-format">(.txt)</span>
                    </label>
                    <input type="file" id="textFileInput" accept=".txt" class="file-input">
                </div>

                <div class="file-card">
                    <div class="file-icon image-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </div>
                    <label for="imageFileInput" class="file-input-label image-type" id="imageInputLabel">
                        Image File
                        <span class="file-format">(.png, .jpg, .jpeg)</span>
                    </label>
                    <input type="file" id="imageFileInput" accept=".png,.jpg,.jpeg" class="file-input">
                </div>

                <div class="file-card">
                    <div class="file-icon audio-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18V5l12-2v13"></path>
                            <circle cx="6" cy="18" r="3"></circle>
                            <circle cx="18" cy="16" r="3"></circle>
                        </svg>
                    </div>
                    <label for="audioFileInput" class="file-input-label audio-type" id="audioInputLabel">
                        Audio File
                        <span class="file-format">(.mp3, .wav)</span>
                    </label>
                    <input type="file" id="audioFileInput" accept=".mp3,.wav" class="file-input">
                </div>
            </div>
        </div>

        <div class="results-section">
            <!-- Original Content Column -->
            <div class="result-column">
                <div class="column-header">
                    <h2>Original Content</h2>
                </div>
                <!-- Text Results -->
                <div id="textResults">
                    <div class="content-card original-text">
                        <pre id="originalText"></pre>
                    </div>
                </div>
                <!-- Image Results -->
                <div id="imageResults" style="display: none;">
                    <div class="content-card original-image">
                        <img id="originalImage" alt="Original image">
                    </div>
                </div>
                <!-- Audio Results -->
                <div id="audioResults" style="display: none;">
                    <div class="content-card original-audio">
                        <audio id="originalAudio" controls></audio>
                        <div class="visualization-card">
                            <div class="waveform">
                                <h4>Time Domain</h4>
                                <img id="originalWaveform" alt="Original Waveform">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preprocessing Column -->
            <div class="result-column">
                <div class="column-header">
                    <h2>Preprocessing</h2>
                </div>
                <!-- Text Preprocessing -->
                <div id="textPreprocessing">
                    <div class="content-card">
                        <div class="select-container">
                            <select id="textPreprocessSelect" name="text_preprocess">
                                <option value="">Select Preprocessing Option</option>
                                {% for option in preprocess_options %}
                                <option value="{{ option }}">{{ option.replace('_', ' ').title() }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="processed-text">
                            <div id="preprocessedResults"></div>
                        </div>
                    </div>
                </div>
                <!-- Image Preprocessing -->
                <div id="imagePreprocessing" style="display: none;">
                    <div class="content-card">
                        <div class="select-container">
                            <select id="imagePreprocessSelect" name="image_preprocess">
                                <option value="">Select Preprocessing Option</option>
                                {% for option in image_preprocess_options %}
                                <option value="{{ option }}">{{ option.replace('_', ' ').title() }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="processed-image">
                            <div id="preprocessedImages"></div>
                        </div>
                    </div>
                </div>
                <!-- Audio Preprocessing -->
                <div id="audioPreprocessing" style="display: none;">
                    <div class="content-card">
                        <div class="select-container">
                            <select id="audioPreprocessSelect" name="audio_preprocess">
                                <option value="">Select Preprocessing Option</option>
                                {% for option in audio_preprocess_options %}
                                <option value="{{ option }}">{{ option.replace('_', ' ').title() }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="processed-audio">
                            <div id="preprocessedAudio"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Augmentation Column -->
            <div class="result-column">
                <div class="column-header">
                    <h2>Augmentation</h2>
                </div>
                <!-- Text Augmentation -->
                <div id="textAugmentation">
                    <div class="content-card">
                        <div class="select-container">
                            <select id="textAugmentSelect" name="text_augmentation">
                                <option value="">Select Augmentation Option</option>
                                {% for option in augmentation_options %}
                                <option value="{{ option }}">{{ option.replace('_', ' ').title() }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="augmented-text">
                            <div id="augmentedResults"></div>
                        </div>
                    </div>
                </div>
                <!-- Image Augmentation -->
                <div id="imageAugmentation" style="display: none;">
                    <div class="content-card">
                        <div class="select-container">
                            <select id="imageAugmentSelect" name="image_augmentation">
                                <option value="">Select Augmentation Option</option>
                                {% for option in image_augmentation_options %}
                                <option value="{{ option }}">{{ option.replace('_', ' ').title() }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="augmented-image">
                            <div id="augmentedImages"></div>
                        </div>
                    </div>
                </div>
                <!-- Audio Augmentation -->
                <div id="audioAugmentation" style="display: none;">
                    <div class="content-card">
                        <div class="select-container">
                            <select id="audioAugmentSelect" name="audio_augmentation">
                                <option value="">Select Augmentation Option</option>
                                {% for option in audio_augmentation_options %}
                                <option value="{{ option }}">{{ option.replace('_', ' ').title() }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="augmented-audio">
                            <div id="augmentedAudio"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 Data Processing Studio. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentFileType = 'text';
        let currentFile = null;

        // Add event listeners for file inputs
        document.getElementById('textFileInput').addEventListener('change', async function(e) {
            await handleFileInput(e, 'text');
        });

        document.getElementById('imageFileInput').addEventListener('change', async function(e) {
            await handleFileInput(e, 'image');
        });

        document.getElementById('audioFileInput').addEventListener('change', async function(e) {
            await handleFileInput(e, 'audio');
        });

        async function handleFileInput(e, type) {
            const file = e.target.files[0];
            if (!file) return;
            
            clearResults();
            clearSelections();
            
            currentFileType = type;
            currentFile = file;
            
            updateUIForFileType(type);
            await displayOriginalContent(file);
        }

        async function displayOriginalContent(file) {
            try {
                setBusyCursor(true);
                
                if (currentFileType === 'text') {
                    const text = await file.text();
                    document.getElementById('originalText').textContent = text;
                } else if (currentFileType === 'image') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('originalImage').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else if (currentFileType === 'audio') {
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    try {
                        // First set the audio source
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('originalAudio').src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                        
                        // Then get the waveform from backend
                        const response = await fetch('/process_audio', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error('Failed to process audio');
                        }
                        
                        const data = await response.json();
                        if (data.original_waveform) {
                            const waveformImg = document.getElementById('originalWaveform');
                            waveformImg.src = `data:image/png;base64,${data.original_waveform}`;
                            waveformImg.style.display = 'block'; // Ensure the image is visible
                        }
                    } catch (error) {
                        console.error('Error getting waveform:', error);
                        document.getElementById('originalWaveform').style.display = 'none';
                    }
                }
            } finally {
                setBusyCursor(false);
            }
        }

        function clearResults() {
            document.getElementById('originalText').textContent = '';
            document.getElementById('preprocessedResults').innerHTML = '';
            document.getElementById('augmentedResults').innerHTML = '';
            
            document.getElementById('originalImage').src = '';
            document.getElementById('preprocessedImages').innerHTML = '';
            document.getElementById('augmentedImages').innerHTML = '';
            
            document.getElementById('originalAudio').src = '';
            document.getElementById('originalWaveform').src = '';
            document.getElementById('preprocessedAudio').innerHTML = '';
            document.getElementById('augmentedAudio').innerHTML = '';
        }

        function clearSelections() {
            document.querySelectorAll('select').forEach(select => {
                select.value = '';
            });
        }

        function updateUIForFileType(type) {
            ['text', 'image', 'audio'].forEach(t => {
                document.getElementById(`${t}Results`).style.display = type === t ? 'block' : 'none';
                document.getElementById(`${t}Preprocessing`).style.display = type === t ? 'block' : 'none';
                document.getElementById(`${t}Augmentation`).style.display = type === t ? 'block' : 'none';
                document.getElementById(`${t}InputLabel`).classList.toggle('active', type === t);
            });
        }

        async function processPreprocessing() {
            if (!currentFile) return;

            setBusyCursor(true);
            const formData = new FormData();
            formData.append('file', currentFile);

            try {
                const endpoint = currentFileType === 'text' ? '/process' : 
                               currentFileType === 'image' ? '/process_image' : '/process_audio';
                const selectId = `${currentFileType}PreprocessSelect`;
                const operation = document.getElementById(selectId).value;

                if (!operation) {
                    document.getElementById(`preprocessed${currentFileType.charAt(0).toUpperCase() + currentFileType.slice(1)}s`).innerHTML = 
                        '<div class="result-item">No preprocessing operation selected</div>';
                    return;
                }

                formData.append('preprocess_ops', operation);
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Processing failed');
                }

                const data = await response.json();
                updateResults(data, 'preprocessed');
            } catch (error) {
                console.error('Error:', error);
                alert(`Error processing ${currentFileType}: ${error.message}`);
            } finally {
                setBusyCursor(false);
            }
        }

        async function processAugmentation() {
            if (!currentFile) return;

            setBusyCursor(true);
            const formData = new FormData();
            formData.append('file', currentFile);

            try {
                const endpoint = currentFileType === 'text' ? '/process' : 
                               currentFileType === 'image' ? '/process_image' : '/process_audio';
                const selectId = `${currentFileType}AugmentSelect`;
                const operation = document.getElementById(selectId).value;

                if (!operation) {
                    document.getElementById(`augmented${currentFileType.charAt(0).toUpperCase() + currentFileType.slice(1)}s`).innerHTML = 
                        '<div class="result-item">No augmentation operation selected</div>';
                    return;
                }

                formData.append('augment_ops', operation);
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Processing failed');
                }

                const data = await response.json();
                updateResults(data, 'augmented');
            } catch (error) {
                console.error('Error:', error);
                alert(`Error processing ${currentFileType}: ${error.message}`);
            } finally {
                setBusyCursor(false);
            }
        }

        function updateResults(data, type) {
            let containerId;
            
            // Determine the correct container ID based on file type and operation type
            if (currentFileType === 'text') {
                containerId = type === 'preprocessed' ? 'preprocessedResults' : 'augmentedResults';
            } else if (currentFileType === 'image') {
                containerId = type === 'preprocessed' ? 'preprocessedImages' : 'augmentedImages';
            } else {
                containerId = type === 'preprocessed' ? 'preprocessedAudio' : 'augmentedAudio';
            }
            
            const resultsContainer = document.getElementById(containerId);
            if (!resultsContainer) {
                console.error(`Container not found: ${containerId}`);
                return;
            }
            
            resultsContainer.innerHTML = '';

            const results = type === 'preprocessed' ? data.preprocessed_results : data.augmented_results;
            const waveforms = type === 'preprocessed' ? data.preprocessed_waveforms : data.augmented_waveforms;

            if (!results || Object.keys(results).length === 0) {
                resultsContainer.innerHTML = `<div class="result-item">No ${type} results</div>`;
                return;
            }

            Object.entries(results).forEach(([op, result]) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';

                if (currentFileType === 'text') {
                    resultItem.innerHTML = `<pre>${result}</pre>`;
                } else if (currentFileType === 'image') {
                    resultItem.innerHTML = `
                        <div class="image-result">
                            <h4>${op.replace('_', ' ').toUpperCase()}</h4>
                            <img src="data:image/png;base64,${result}" alt="${op} result">
                        </div>
                    `;
                } else if (currentFileType === 'audio') {
                    resultItem.innerHTML = `
                        <audio src="data:audio/wav;base64,${result}" controls></audio>
                        <div class="visualization-card">
                            <div class="waveform">
                                <h4>Time Domain</h4>
                                <img src="data:image/png;base64,${waveforms[op]}" alt="${op} waveform">
                            </div>
                        </div>
                    `;
                }

                resultsContainer.appendChild(resultItem);
            });
        }

        function setBusyCursor(busy) {
            document.body.style.cursor = busy ? 'wait' : 'default';
            document.querySelectorAll('select').forEach(select => {
                select.disabled = busy;
            });
        }

        // Add event listeners for dropdowns
        ['text', 'image', 'audio'].forEach(type => {
            document.getElementById(`${type}PreprocessSelect`).addEventListener('change', processPreprocessing);
            document.getElementById(`${type}AugmentSelect`).addEventListener('change', processAugmentation);
        });
    </script>
</body>
</html> 